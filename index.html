<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zootopia Cloud Pro</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Poppins:wght@400;600&display=swap');
        :root { --gold: #FFD700; --accent: #00FFFF; --bg: #0A0A12; --card: #1C1C2E; }
        body { font-family: 'Poppins', sans-serif; background: var(--bg); color: white; margin: 0; overflow: hidden; touch-action: none; }
        .header { text-align: center; padding: 15px; background: rgba(0,0,0,0.5); border-bottom: 1px solid #333; }
        .balance { font-family: 'Orbitron'; font-size: 32px; color: var(--gold); }
        .tab-content { display: none; height: calc(100vh - 160px); overflow-y: auto; padding: 20px; }
        .tab-content.active { display: block; }
        .card { background: var(--card); border-radius: 12px; padding: 15px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; border: 1px solid rgba(255,255,255,0.1); }
        .btn-action { background: var(--gold); color: black; border: none; padding: 10px 15px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn-action:disabled { background: #444; color: #888; }
        .click-area { display: flex; justify-content: center; align-items: center; height: 260px; position: relative; }
        .pet-image { width: 180px; cursor: pointer; transition: 0.05s; }
        .pet-image:active { transform: scale(0.92); }
        .nav { position: fixed; bottom: 0; width: 100%; display: flex; background: #111; padding: 12px 0; border-top: 1px solid #333; }
        .nav-item { flex: 1; text-align: center; color: #666; font-size: 11px; cursor: pointer; }
        .nav-item.active { color: var(--accent); }
        .nav-item i { font-size: 20px; margin-bottom: 4px; display: block; }
        #loading { position: fixed; top:0; left:0; width:100%; height:100%; background:var(--bg); z-index:999; display:flex; align-items:center; justify-content:center; flex-direction: column; }
    </style>
</head>
<body>

<div id="loading">
    <h2 style="font-family:'Orbitron'; color:var(--gold)">ZOOTOPIA</h2>
    <p>–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –æ–±–ª–∞–∫–æ–º...</p>
</div>

<div class="header">
    <div class="balance" id="bones">0</div>
    <div style="color:var(--accent); font-size:14px; font-family:'Orbitron'">$ZOO: <span id="zoo">0.0000</span></div>
</div>

<div id="tab-game" class="tab-content active">
    <div class="click-area"><img src="dachshund.png" class="pet-image" id="pet"></div>
    <div style="padding:10px">
        <p>‚ö° –≠–Ω–µ—Ä–≥–∏—è: <span id="energy">1000</span>/1000</p>
        <p style="font-size:12px; color:#888">–°–∏–ª–∞ –∫–ª–∏–∫–∞: +<span id="power">1</span></p>
    </div>
</div>

<div id="tab-shop" class="tab-content">
    <h3 style="color:var(--gold)">–£–ª—É—á—à–µ–Ω–∏—è</h3>
    <div class="card">
        <div><b>–°–∏–ª–∞ —Ç–∞–ø–∞</b><br><small id="price-tap">500</small> ü¶¥</div>
        <button class="btn-action" onclick="buy('tap')">–ö–£–ü–ò–¢–¨</button>
    </div>
    <div class="card" style="opacity: 0.5;">
        <div><b>–ê–≤—Ç–æ-–±–æ—Ç</b><br><small>–°–∫–æ—Ä–æ</small></div>
        <button class="btn-action" disabled>LOCK</button>
    </div>
</div>

<div id="tab-friends" class="tab-content">
    <h3 style="color:var(--accent)">–ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–∑–µ–π</h3>
    <div class="card" style="background: linear-gradient(45deg, #1C1C2E, #2A2A3E);">
        <div style="flex:1"><b>+50,000 Bones</b><br><small>–∑–∞ –∫–∞–∂–¥–æ–≥–æ –¥—Ä—É–≥–∞</small></div>
        <button class="btn-action" onclick="invite()">–ü–†–ò–ì–õ–ê–°–ò–¢–¨</button>
    </div>
    <p style="font-size:12px; color:#888; text-align:center">–¢–≤–æ–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—ã: <span id="ref-count">0</span></p>
</div>

<div class="nav">
    <div class="nav-item active" onclick="switchTab('tab-game', this)"><i class="fas fa-paw"></i>–ò–≥—Ä–∞</div>
    <div class="nav-item" onclick="switchTab('tab-shop', this)"><i class="fas fa-shopping-cart"></i>–ú–∞–≥–∞–∑–∏–Ω</div>
    <div class="nav-item" onclick="switchTab('tab-friends', this)"><i class="fas fa-users"></i>–î—Ä—É–∑—å—è</div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAT4Qt--BNvqA953AQNUbbpiDHbSvO3BfE",
        authDomain: "zootopia-f046d.firebaseapp.com",
        projectId: "zootopia-f046d",
        storageBucket: "zootopia-f046d.firebasestorage.app",
        messagingSenderId: "531125789476",
        appId: "1:531125789476:web:7e504c4d855fd397fa49b1"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const tg = window.Telegram.WebApp;
    const uid = tg.initDataUnsafe?.user?.id?.toString() || "dev_user";
    
    // –ü–æ–ª—É—á–∞–µ–º ID –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—è –∏–∑ —Å—Å—ã–ª–∫–∏ —Å—Ç–∞—Ä—Ç–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
    const urlParams = new URLSearchParams(window.location.search);
    const referrerId = tg.initDataUnsafe?.start_param || null;

    let state = { 
        bones: 0, zoo: 0, energy: 1000, 
        tapPower: 1, tapPrice: 500,
        refs: 0, rewarded: false 
    };

    async function init() {
        const doc = await db.collection("users").doc(uid).get();
        if (doc.exists) {
            state = { ...state, ...doc.data() };
        } else {
            // –ï—Å–ª–∏ –Ω–æ–≤—ã–π –∏–≥—Ä–æ–∫ –∏ –ø—Ä–∏—à–µ–ª –ø–æ —Å—Å—ã–ª–∫–µ
            if (referrerId && referrerId !== uid) {
                state.bones += 50000;
                giveBonusToReferrer(referrerId);
            }
            await db.collection("users").doc(uid).set(state);
        }
        document.getElementById('loading').style.display = 'none';
        update();
    }

    async function giveBonusToReferrer(rid) {
        const rDoc = await db.collection("users").doc(rid).get();
        if (rDoc.exists) {
            let rData = rDoc.data();
            rData.bones += 50000;
            rData.refs = (rData.refs || 0) + 1;
            await db.collection("users").doc(rid).set(rData);
        }
    }

    function update() {
        document.getElementById('bones').innerText = Math.floor(state.bones);
        document.getElementById('zoo').innerText = state.zoo.toFixed(4);
        document.getElementById('energy').innerText = state.energy;
        document.getElementById('power').innerText = state.tapPower;
        document.getElementById('price-tap').innerText = state.tapPrice;
        document.getElementById('ref-count').innerText = state.refs || 0;
    }

    function buy(type) {
        if (state.bones >= state.tapPrice) {
            state.bones -= state.tapPrice;
            state.tapPower++;
            state.tapPrice = Math.floor(state.tapPrice * 1.6);
            save(); update();
        }
    }

    function invite() {
        const text = `–ó–∞—Ö–æ–¥–∏ –≤ Zootopia Clicker! –î–∞—é—Ç 50–∫ –∫–æ—Å—Ç–µ–π –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø–æ –º–æ–µ–π —Å—Å—ã–ª–∫–µ! üêæ`;
        const shareUrl = `https://t.me/share/url?url=https://t.me/zooclikbot?start=${uid}&text=${encodeURIComponent(text)}`;
        tg.openTelegramLink(shareUrl);
    }

    function handleTap() {
        if (state.energy >= state.tapPower) {
            state.bones += state.tapPower;
            state.zoo += (0.0001 * state.tapPower);
            state.energy -= state.tapPower;
            update();
        }
    }

    async function save() { await db.collection("users").doc(uid).set(state); }
    
    function switchTab(id, el) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        el.classList.add('active');
    }

    document.getElementById('pet').addEventListener('pointerdown', handleTap);
    setInterval(() => { if (state.energy < 1000) { state.energy = Math.min(1000, state.energy + 2); update(); } }, 2000);
    setInterval(save, 15000); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –æ–±–ª–∞–∫–æ –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫

    init();
</script>
</body>
</html>
