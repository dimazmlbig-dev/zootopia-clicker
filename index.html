<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Zootopia: Ultimate</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Orbitron:wght@700&display=swap');
        
        :root { 
            --blue-bg: #1A5CC7; --gold: #FFD700; --bubble-text: #E57373;
        }

        body { 
            font-family: 'Fredoka', sans-serif; background: var(--blue-bg);
            color: white; margin: 0; height: 100vh; width: 100vw;
            overflow: hidden; display: flex; flex-direction: column;
        }

        /* --- –ì–õ–ê–í–ù–´–ô –≠–ö–†–ê–ù (–∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ –∫–æ–¥–∞) --- */
        .header { text-align: center; padding-top: calc(env(safe-area-inset-top) + 15px); z-index: 10; }
        .main-score { font-family: 'Orbitron'; font-size: 42px; }
        .sub-score { font-family: 'Orbitron'; font-size: 14px; color: var(--gold); }

        .main-view { flex-grow: 1; position: relative; display: flex; align-items: center; justify-content: center; }
        
        .bubble {
            position: absolute; background: white; border-radius: 30px;
            padding: 10px 15px; color: var(--bubble-text); font-weight: 600;
            box-shadow: 4px 4px 0px rgba(0,0,0,0.1); font-size: 13px; text-align: center;
            animation: floatBubble 3s ease-in-out infinite; cursor: pointer; z-index: 20;
        }
        @keyframes floatBubble { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }

        .b-top-left { top: 10%; left: 5%; }
        .b-mid-left { top: 35%; left: 2%; }
        .b-bot-left { bottom: 20%; left: 5%; }
        .b-top-right { top: 10%; right: 5%; }
        .b-mid-right { top: 35%; right: 2%; }
        .b-bot-right { bottom: 20%; right: 5%; }

        .character-container { text-align: center; }
        .pet-img { width: 50vw; max-width: 200px; filter: drop-shadow(0 10px 10px rgba(0,0,0,0.3)); }

        /* --- –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê --- */
        .modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.85);
            display: none; z-index: 1000; flex-direction: column;
            padding: 40px 20px; backdrop-filter: blur(10px);
        }
        .modal.active { display: flex; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .close-btn { font-size: 30px; color: white; cursor: pointer; }

        /* --- –ù–û–í–û–°–¢–ò --- */
        .news-item { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 15px; margin-bottom: 10px; border-left: 4px solid var(--gold); }
        .news-date { font-size: 10px; opacity: 0.6; }

        /* --- –¢–†–ò –í –†–Ø–î (–£–ø—Ä–æ—â–µ–Ω–Ω–∞—è) --- */
        .game-grid { 
            display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; 
            background: rgba(255,255,255,0.1); padding: 10px; border-radius: 15px;
        }
        .cell { 
            aspect-ratio: 1; background: rgba(255,255,255,0.2); 
            display: flex; align-items: center; justify-content: center; 
            font-size: 24px; border-radius: 10px; cursor: pointer;
        }

        /* --- –≠–ù–ï–†–ì–ò–Ø –ò –ù–ê–í --- */
        .energy-section { padding: 15px; z-index: 10; }
        .energy-bar-cont { width: 100%; height: 30px; background: rgba(0,0,0,0.3); border-radius: 15px; position: relative; overflow: hidden; }
        .energy-fill { height: 100%; width: 100%; background: linear-gradient(90deg, #FFE082, #FFB74D); transition: 0.3s; }
        .energy-text { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; }
    </style>
</head>
<body>

<header class="header">
    <div class="main-score" id="bones">0</div>
    <div class="sub-score">$ZOO: <span id="zoo-val">0.0000</span></div>
</header>

<main class="main-view">
    <div class="bubble b-top-left">—Ç–æ–ø<br>—É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</div>
    <div class="bubble b-mid-left" onclick="openModal('news-modal')">–Ω–æ–≤–æ—Å—Ç–∏</div>
    <div class="bubble b-bot-left" onclick="openModal('game-modal')">3 –≤ —Ä—è–¥</div>

    <div class="character-container">
        <img src="dachshund.png" class="pet-img" id="pet" onclick="handleTap()">
    </div>

    <div class="bubble b-top-right">NFT</div>
    <div class="bubble b-mid-right" onclick="tonConnectUI.openModal()">–º–æ–π<br>–∫–æ—à–µ–ª–µ–∫</div>
    <div class="bubble b-bot-right">–º–∞–≥–∞–∑–∏–Ω</div>
</main>

<div id="news-modal" class="modal">
    <div class="modal-header">
        <h2>–ù–û–í–û–°–¢–ò üêæ</h2>
        <div class="close-btn" onclick="closeModal('news-modal')">&times;</div>
    </div>
    <div class="news-item">
        <div class="news-date">16 –Ø–Ω–≤–∞—Ä—è 2026</div>
        <b>–ó–∞–ø—É—Å–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –¥–∏–∑–∞–π–Ω–∞!</b>
        <p>–ú—ã –æ–±–Ω–æ–≤–∏–ª–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –¢–µ–ø–µ—Ä—å —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç–∞–∫—Å–æ–π —Å—Ç–∞–ª–æ –µ—â–µ —É–¥–æ–±–Ω–µ–µ.</p>
    </div>
    <div class="news-item">
        <div class="news-date">14 –Ø–Ω–≤–∞—Ä—è 2026</div>
        <b>–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è TON Connect</b>
        <p>–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–∏–≤—è–∑–∞—Ç—å —Å–≤–æ–π –∫–æ—à–µ–ª–µ–∫ –ø—Ä—è–º–æ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.</p>
    </div>
</div>

<div id="game-modal" class="modal">
    <div class="modal-header">
        <div>
            <h2>Zootopia Match</h2>
            <small>–ù–∞–∂–∏–º–∞–π –Ω–∞ –≥—Ä—É–ø–ø—ã –æ—Ç 3-—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤!</small>
        </div>
        <div class="close-btn" onclick="closeModal('game-modal')">&times;</div>
    </div>
    <div id="grid" class="game-grid"></div>
    <div style="margin-top: 20px; text-align: center;">
        –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏: <span id="game-reward" style="color:var(--gold)">0</span> $ZOO
    </div>
</div>

<section class="energy-section">
    <div class="energy-bar-cont">
        <div class="energy-fill" id="energy-fill"></div>
        <div class="energy-text">‚ö° <span id="en-cur">1000</span> / 1000</div>
    </div>
</section>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
        manifestUrl: 'https://raw.githubusercontent.com/ton-connect/demo-dapp-with-react-ui/master/public/tonconnect-manifest.json',
    });

    let state = { bones: 0, zoo: 0, energy: 1000 };

    function handleTap() {
        if (state.energy > 0) {
            state.bones += 1;
            state.zoo += 0.0001;
            state.energy -= 1;
            updateUI();
            tg.HapticFeedback.impactOccurred('light');
        }
    }

    function updateUI() {
        document.getElementById('bones').innerText = Math.floor(state.bones).toLocaleString();
        document.getElementById('zoo-val').innerText = state.zoo.toFixed(4);
        document.getElementById('en-cur').innerText = state.energy;
        document.getElementById('energy-fill').style.width = (state.energy / 10) + '%';
    }

    // --- –ú–û–î–ê–õ–ö–ò ---
    function openModal(id) { 
        document.getElementById(id).classList.add('active'); 
        if(id === 'game-modal') initGame();
    }
    function closeModal(id) { document.getElementById(id).classList.remove('active'); }

    // --- –õ–û–ì–ò–ö–ê –ò–ì–†–´ (Match 3 Simplified) ---
    function initGame() {
        const grid = document.getElementById('grid');
        grid.innerHTML = '';
        const icons = ['ü¶¥', 'üêæ', 'üê∂', 'üéæ', 'ü•©'];
        for (let i = 0; i < 25; i++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.innerText = icons[Math.floor(Math.random() * icons.length)];
            cell.onclick = () => {
                state.zoo += 0.005;
                cell.innerText = icons[Math.floor(Math.random() * icons.length)];
                document.getElementById('game-reward').innerText = (parseFloat(document.getElementById('game-reward').innerText) + 0.005).toFixed(3);
                updateUI();
                tg.HapticFeedback.notificationOccurred('success');
            };
            grid.appendChild(cell);
        }
    }

    setInterval(() => {
        if (state.energy < 1000) { state.energy = Math.min(1000, state.energy + 2); updateUI(); }
    }, 1500);

    updateUI();
</script>
</body>
</html>
