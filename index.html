<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Zootopia: Final Edition</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üê∂</text></svg>">
    
    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- TON Connect UI -->
    <script src="https://unpkg.com/@tonconnect/ui@2.0.3/dist/tonconnect-ui.min.js"></script>
    
    <!-- Font Awesome -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    
    <!-- Firebase (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Orbitron:wght@700&display=swap');
        
        :root {
            --blue: #1A5CC7;
            --gold: #FFD700;
            --accent: #FF8D29;
            --green: #4CAF50;
            --red: #F44336;
        }
        
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-drag: none;
        }
        
        body {
            font-family: 'Fredoka', sans-serif;
            background: linear-gradient(135deg, var(--blue) 0%, #0d3a8a 100%);
            color: white;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        /* –®–ê–ü–ö–ê */
        .header {
            text-align: center;
            padding-top: calc(env(safe-area-inset-top) + 10px);
            z-index: 100;
            background: rgba(0, 0, 0, 0.2);
            padding-bottom: 10px;
            backdrop-filter: blur(5px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .score {
            font-family: 'Orbitron', sans-serif;
            font-size: 42px;
            line-height: 1;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            background: linear-gradient(45deg, var(--gold), #FF8D29);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .currency {
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
            color: var(--gold);
            margin-top: 5px;
        }
        
        /* –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ */
        .content {
            flex-grow: 1;
            position: relative;
            overflow: hidden;
        }
        
        .tab-panel {
            display: none;
            height: 100%;
            width: 100%;
            padding: 20px;
            overflow-y: auto;
            padding-bottom: calc(80px + env(safe-area-inset-bottom));
        }
        
        .tab-panel.active {
            display: flex;
            flex-direction: column;
        }
        
        /* –ò–ì–†–ê (–ì–õ–ê–í–ù–ê–Ø) */
        .game-area {
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-around;
        }
        
        .bubble-btn {
            position: absolute;
            background: white;
            color: #E57373;
            font-weight: 600;
            padding: 10px 18px;
            border-radius: 25px;
            font-size: 13px;
            text-align: center;
            box-shadow: 3px 3px 0 rgba(0, 0, 0, 0.2);
            animation: float 3s infinite ease-in-out;
            cursor: pointer;
            z-index: 50;
            border: none;
            transition: transform 0.2s;
        }
        
        .bubble-btn:active {
            transform: scale(0.95);
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        
        .character-box {
            position: relative;
            width: 60vw;
            max-width: 280px;
            min-height: 280px;
            transition: transform 0.1s;
            cursor: pointer;
        }
        
        .character-box:active {
            transform: scale(0.92);
        }
        
        .main-pet {
            width: 100%;
            height: auto;
            z-index: 5;
            position: relative;
            filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.3));
        }
        
        .nft-overlay {
            position: absolute;
            inset: 0;
            z-index: 10;
            pointer-events: none;
            display: none;
            width: 100%;
            height: auto;
        }
        
        .nft-overlay.visible {
            display: block;
        }
        
        /* –≠–ù–ï–†–ì–ò–Ø */
        .energy-container {
            width: 90%;
            max-width: 400px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 12px 15px;
            margin-bottom: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .energy-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .energy-fill {
            height: 100%;
            background: linear-gradient(90deg, #FFEF5E, #FF8D29);
            width: 100%;
            transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            border-radius: 10px;
        }
        
        /* –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ (–†–ê–ó–î–ï–õ–´) */
        .nav-bar {
            height: 80px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(15px);
            display: flex;
            padding-bottom: env(safe-area-inset-bottom);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            opacity: 0.6;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .nav-item.active {
            opacity: 1;
            color: var(--gold);
            transform: translateY(-5px);
        }
        
        .nav-item i {
            font-size: 22px;
            margin-bottom: 4px;
            transition: transform 0.3s;
        }
        
        .nav-item.active i {
            transform: scale(1.1);
        }
        
        /* –ö–ê–†–¢–û–ß–ö–ò –í –°–ü–ò–°–ö–ê–• */
        .card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 18px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: transform 0.2s;
        }
        
        .card:active {
            transform: scale(0.98);
        }
        
        .btn-action {
            background: linear-gradient(135deg, var(--gold), #FF8D29);
            border: none;
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            color: #333;
            font-size: 14px;
            transition: all 0.2s;
            box-shadow: 0 4px 10px rgba(255, 215, 0, 0.3);
        }
        
        .btn-action:active {
            transform: scale(0.95);
            box-shadow: 0 2px 5px rgba(255, 215, 0, 0.2);
        }
        
        .btn-action:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* –ú–ò–ù–ò-–ò–ì–†–ê */
        .match3-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-top: 20px;
            max-width: 320px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .cell {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.2s;
            backdrop-filter: blur(5px);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .cell:active {
            transform: scale(0.9);
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* –ê–ù–ò–ú–ê–¶–ò–ò */
        .tap-animation {
            position: absolute;
            pointer-events: none;
            animation: floatUp 1s forwards;
            font-size: 28px;
            color: var(--gold);
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            z-index: 100;
        }
        
        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-60px) scale(1.2);
            }
        }
        
        /* –ï–ñ–ï–î–ù–ï–í–ù–´–ï –ù–ê–ì–†–ê–î–´ */
        .daily-rewards {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .daily-day {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .daily-day.claimed {
            background: linear-gradient(135deg, var(--green), #2E7D32);
            transform: scale(1.05);
        }
        
        .daily-day.today {
            border: 2px solid var(--gold);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.4); }
            50% { box-shadow: 0 0 0 10px rgba(255, 215, 0, 0); }
        }
        
        /* –†–ï–§–ï–†–ê–õ–¨–ù–ê–Ø –°–ò–°–¢–ï–ú–ê */
        .referral-box {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(33, 150, 243, 0.2));
            border-radius: 15px;
            padding: 15px;
            margin-top: 20px;
            text-align: center;
        }
        
        .referral-link {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
            word-break: break-all;
            font-family: monospace;
            font-size: 12px;
        }
        
        /* –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ */
        @media (max-width: 480px) {
            .score {
                font-size: 36px;
            }
            
            .character-box {
                width: 70vw;
                min-height: 250px;
            }
            
            .nav-item i {
                font-size: 20px;
            }
            
            .nav-item {
                font-size: 10px;
            }
            
            .bubble-btn {
                padding: 8px 15px;
                font-size: 12px;
            }
        }
        
        /* –ü–†–û–ì–†–ï–°–° –ë–ê–† –ó–ê–ì–†–£–ó–ö–ò */
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--blue);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s;
        }
        
        .loader.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loader-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--gold);
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: rgba(26, 92, 199, 0.95);
            border-radius: 20px;
            padding: 25px;
            max-width: 90%;
            width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            border: 2px solid var(--gold);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        /* –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            transform: translateX(150%);
            transition: transform 0.3s;
            z-index: 3000;
            backdrop-filter: blur(10px);
        }
        
        .notification.active {
            transform: translateX(0);
        }
        
        .notification.error {
            background: rgba(244, 67, 54, 0.9);
        }
        
        .notification.warning {
            background: rgba(255, 141, 41, 0.9);
        }
        
        /* –ü–û–õ–û–°–ê –ü–†–û–ì–†–ï–°–°–ê –£–†–û–í–ù–Ø */
        .level-container {
            width: 90%;
            max-width: 400px;
            margin: 10px 0;
        }
        
        .level-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .level-fill {
            height: 100%;
            background: linear-gradient(90deg, #9C27B0, #E91E63);
            border-radius: 3px;
            transition: width 0.5s;
        }
        
        h1, h2, h3 {
            margin-top: 0;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
        }
        
        h2 {
            color: var(--gold);
            font-size: 22px;
            margin-bottom: 20px;
        }
        
        small {
            opacity: 0.8;
            font-size: 12px;
        }
        
        /* –°–ö–†–û–õ–õ–ë–ê–† */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--gold);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #FF8D29;
        }
    </style>
</head>
<body>

<!-- –ó–∞–≥—Ä—É–∑—á–∏–∫ -->
<div class="loader" id="loader">
    <div class="loader-spinner"></div>
    <div>–ó–∞–≥—Ä—É–∑–∫–∞ Zootopia...</div>
</div>

<!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
<div class="notification" id="notification"></div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π -->
<div class="modal" id="achievement-modal">
    <div class="modal-content">
        <h2>üéâ –ù–æ–≤–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ!</h2>
        <p id="achievement-text"></p>
        <button class="btn-action" onclick="hideModal('achievement-modal')" style="width: 100%; margin-top: 20px;">
            –û—Ç–ª–∏—á–Ω–æ!
        </button>
    </div>
</div>

<header class="header">
    <div class="score" id="bones">0</div>
    <div class="currency">$ZOO: <span id="zoo-val">0.0000</span></div>
    <div class="level-container">
        <div style="font-size: 12px; display: flex; justify-content: space-between;">
            <span>–£—Ä–æ–≤–µ–Ω—å <span id="level">1</span></span>
            <span id="level-progress">0/1000</span>
        </div>
        <div class="level-bar">
            <div class="level-fill" id="level-fill" style="width: 0%;"></div>
        </div>
    </div>
</header>

<div class="content">
    <!-- –í–ö–õ–ê–î–ö–ê: –ì–õ–ê–í–ù–ê–Ø -->
    <div id="tab-main" class="tab-panel active">
        <div class="game-area">
            <button class="bubble-btn" style="top: 10%; left: 5%;" onclick="showTab('tab-top', this)">
                üèÜ –¢–û–ü
            </button>
            <button class="bubble-btn" style="top: 10%; right: 5%;" onclick="connectWallet()">
                üí≥ –ö–û–®–ï–õ–ï–ö
            </button>
            <button class="bubble-btn" style="top: 30%; left: 2%;" onclick="showTab('tab-news', this)">
                üîî –ù–û–í–û–°–¢–ò
            </button>
            <button class="bubble-btn" style="bottom: 30%; right: 2%;" onclick="showDailyRewards()">
                üéÅ –î–ï–ù–¨ <span id="day-streak">0</span>
            </button>
            
            <div id="evo-label" style="font-size: 18px; font-weight: 600; margin-bottom: 10px; text-align: center;">
                üê∂ –ú–∞–ª—ã—à –¢–∞–∫—Å–∞
            </div>
            
            <div class="character-box" onclick="handleTap(event)">
                <img src="https://api.dicebear.com/7.x/shapes/svg?seed=glasses&backgroundColor=1A5CC7" 
                     id="nft-glasses" class="nft-overlay" alt="NFT –û—á–∫–∏">
                <img src="https://api.dicebear.com/7.x/shapes/svg?seed=hat&backgroundColor=1A5CC7" 
                     id="nft-hat" class="nft-overlay" alt="NFT –®–ª—è–ø–∞">
                <img src="https://api.dicebear.com/7.x/bottts/svg?seed=dachshund&backgroundColor=1A5CC7" 
                     id="pet-img" class="main-pet" alt="–ü–∏—Ç–æ–º–µ—Ü">
            </div>
            
            <div style="font-size: 14px; margin: 10px 0; text-align: center;">
                –°–∏–ª–∞ —Ç–∞–ø–∞: <span id="tap-power">1</span> ü¶¥
            </div>
            
            <div class="energy-container">
                <div style="font-size: 14px; margin-bottom: 8px; font-weight: bold; display: flex; justify-content: space-between;">
                    <span>‚ö° –≠–Ω–µ—Ä–≥–∏—è</span>
                    <span id="en-cur">1000</span> / 1000
                </div>
                <div class="energy-bar">
                    <div class="energy-fill" id="en-fill" style="width: 100%;"></div>
                </div>
            </div>
            
            <div class="referral-box" id="referral-section" style="display: none;">
                <h3>üë• –ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–≥–∞!</h3>
                <p>–ü–æ–ª—É—á–∏—Ç–µ –ø–æ 1000 ü¶¥ –∫–∞–∂–¥—ã–π!</p>
                <div class="referral-link" id="referral-link">
                    –ó–∞–≥—Ä—É–∑–∫–∞...
                </div>
                <button class="btn-action" onclick="copyReferralLink()">
                    üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
                </button>
            </div>
        </div>
    </div>
    
    <!-- –í–ö–õ–ê–î–ö–ê: –ú–ê–ì–ê–ó–ò–ù -->
    <div id="tab-shop" class="tab-panel">
        <h2>üõí –ú–∞–≥–∞–∑–∏–Ω –ë—É—Å—Ç–æ–≤</h2>
        
        <div class="card">
            <div>
                <b>üí™ –°–∏–ª–∞ —Ç–∞–ø–∞</b><br>
                <small>–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∫–æ—Å—Ç–∏ –∑–∞ –∫–ª–∏–∫</small><br>
                <span id="tap-price" style="color: var(--gold); font-weight: bold;">500 ü¶¥</span>
            </div>
            <button class="btn-action" onclick="upgradeTap()">
                Lvl <span id="tap-lvl">1</span>
            </button>
        </div>
        
        <div class="card">
            <div>
                <b>‚ö° –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏</b><br>
                <small>–ë—ã—Å—Ç—Ä–µ–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —ç–Ω–µ—Ä–≥–∏—é</small><br>
                <span id="energy-price" style="color: var(--gold); font-weight: bold;">1000 ü¶¥</span>
            </div>
            <button class="btn-action" onclick="upgradeEnergy()">
                Lvl <span id="energy-lvl">1</span>
            </button>
        </div>
        
        <h2>üëï NFT –ì–∞—Ä–¥–µ—Ä–æ–±</h2>
        
        <div class="card">
            <div>
                <b>üï∂Ô∏è –û—á–∫–∏ Cyber</b><br>
                <small>–°—Ç–∏–ª—å–Ω—ã–µ –æ—á–∫–∏ –¥–ª—è –ø–∏—Ç–æ–º—Ü–∞</small><br>
                <span style="color: var(--gold); font-weight: bold;">10 $ZOO</span>
            </div>
            <button class="btn-action" id="buy-glasses" onclick="buyNFT('glasses', 10)">
                –ö—É–ø–∏—Ç—å
            </button>
        </div>
        
        <div class="card">
            <div>
                <b>üé© –®–ª—è–ø–∞ Gentleman</b><br>
                <small>–≠–ª–µ–≥–∞–Ω—Ç–Ω–∞—è —à–ª—è–ø–∞</small><br>
                <span style="color: var(--gold); font-weight: bold;">15 $ZOO</span>
            </div>
            <button class="btn-action" id="buy-hat" onclick="buyNFT('hat', 15)">
                –ö—É–ø–∏—Ç—å
            </button>
        </div>
        
        <div class="card">
            <div>
                <b>üëë –ö–æ—Ä–æ–Ω–∞ –ö–æ—Ä–æ–ª—è</b><br>
                <small>–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∞—è –∫–æ—Ä–æ–Ω–∞</small><br>
                <span style="color: var(--gold); font-weight: bold;">50 $ZOO</span>
            </div>
            <button class="btn-action" id="buy-crown" onclick="buyNFT('crown', 50)">
                –ö—É–ø–∏—Ç—å
            </button>
        </div>
    </div>
    
    <!-- –í–ö–õ–ê–î–ö–ê: –ú–ò–ù–ò-–ò–ì–†–ê -->
    <div id="tab-game" class="tab-panel">
        <h2>üéÆ Zootopia Match</h2>
        <p>–ù–∞–∂–∏–º–∞–π –Ω–∞ –∫–æ—Å—Ç–æ—á–∫–∏ –∏ –ø–æ–ª—É—á–∞–π $ZOO!</p>
        <p>–°–æ–±—Ä–∞–Ω–æ: <span id="game-score">0</span> ü¶¥</p>
        
        <div id="grid" class="match3-grid"></div>
        
        <div style="text-align: center; margin-top: 20px;">
            <button class="btn-action" onclick="resetGame()" style="margin: 5px;">
                üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
            </button>
            <button class="btn-action" onclick="claimGameRewards()" id="claim-game-btn" style="margin: 5px;">
                üèÜ –ó–∞–±—Ä–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—É
            </button>
        </div>
        
        <div style="margin-top: 20px; font-size: 14px; opacity: 0.8;">
            <b>üéØ –ó–∞–¥–∞–Ω–∏–µ:</b> –°–æ–±–µ—Ä–∏ 20 –∫–æ—Å—Ç–æ—á–µ–∫ –∑–∞ –æ–¥–Ω—É —Å–µ—Å—Å–∏—é, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –±–æ–Ω—É—Å!
        </div>
    </div>
    
    <!-- –í–ö–õ–ê–î–ö–ê: –ù–û–í–û–°–¢–ò -->
    <div id="tab-news" class="tab-panel">
        <h2>üì¢ –ù–æ–≤–æ—Å—Ç–∏</h2>
        
        <div class="card">
            <div>
                <b>üé® –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∏–∑–∞–π–Ω–∞!</b><br>
                <small>–°–µ–≥–æ–¥–Ω—è, 10:30</small><br>
                <span>–¢–µ–ø–µ—Ä—å –Ω–∞–≤–∏–≥–∞—Ü–∏—è –≤–Ω–∏–∑—É, –¥–æ–±–∞–≤–ª–µ–Ω—ã –∞–Ω–∏–º–∞—Ü–∏–∏ –∏ —É–ª—É—á—à–µ–Ω UI.</span>
            </div>
        </div>
        
        <div class="card">
            <div>
                <b>üíé TON –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è</b><br>
                <small>–í—á–µ—Ä–∞, 14:45</small><br>
                <span>–ö–æ—à–µ–ª–µ–∫ TON —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç. –ü–æ–¥–∫–ª—é—á–∞–π –∏ –ø–æ–ª—É—á–∞–π –±–æ–Ω—É—Å!</span>
            </div>
        </div>
        
        <div class="card">
            <div>
                <b>üèÜ –ù–æ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</b><br>
                <small>2 –¥–Ω—è –Ω–∞–∑–∞–¥, 09:15</small><br>
                <span>–î–æ–±–∞–≤–ª–µ–Ω—ã –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∑–∞ 1000, 5000 –∏ 10000 –∫–ª–∏–∫–æ–≤!</span>
            </div>
        </div>
        
        <div class="card">
            <div>
                <b>üéÅ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã</b><br>
                <small>3 –¥–Ω—è –Ω–∞–∑–∞–¥, 11:20</small><br>
                <span>–ó–∞—Ö–æ–¥–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã!</span>
            </div>
        </div>
        
        <div class="card">
            <div>
                <b>üë• –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</b><br>
                <small>5 –¥–Ω–µ–π –Ω–∞–∑–∞–¥, 16:40</small><br>
                <span>–ü—Ä–∏–≥–ª–∞—à–∞–π –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π –±–æ–Ω—É—Å—ã –∑–∞ –∫–∞–∂–¥–æ–≥–æ!</span>
            </div>
        </div>
    </div>
    
    <!-- –í–ö–õ–ê–î–ö–ê: –¢–û–ü –ò–ì–†–û–ö–û–í -->
    <div id="tab-top" class="tab-panel">
        <h2>üèÜ –¢–æ–ø —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</h2>
        
        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
            <button class="btn-action" onclick="loadTop('bones')" style="flex: 1;">
                ü¶¥ –ü–æ –∫–æ—Å—Ç—è–º
            </button>
            <button class="btn-action" onclick="loadTop('zoo')" style="flex: 1;">
                üíé –ü–æ $ZOO
            </button>
            <button class="btn-action" onclick="loadTop('tap')" style="flex: 1;">
                üí™ –ü–æ —Å–∏–ª–µ
            </button>
        </div>
        
        <div id="top-list">
            <div class="card">
                <div style="display: flex; align-items: center; width: 100%;">
                    <div style="font-size: 24px; margin-right: 15px; color: var(--gold);">ü•á</div>
                    <div style="flex-grow: 1;">
                        <b>NickName_1</b><br>
                        <small>1,234,567 ü¶¥ ‚Ä¢ 12.3456 $ZOO</small>
                    </div>
                    <div style="font-weight: bold; color: var(--gold);">
                        –£—Ä. 25
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div style="display: flex; align-items: center; width: 100%;">
                    <div style="font-size: 24px; margin-right: 15px; color: silver;">ü•à</div>
                    <div style="flex-grow: 1;">
                        <b>Player_Two</b><br>
                        <small>987,654 ü¶¥ ‚Ä¢ 9.8765 $ZOO</small>
                    </div>
                    <div style="font-weight: bold; color: silver;">
                        –£—Ä. 18
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div style="display: flex; align-items: center; width: 100%;">
                    <div style="font-size: 24px; margin-right: 15px; color: #cd7f32;">ü•â</div>
                    <div style="flex-grow: 1;">
                        <b>Gamer_Pro</b><br>
                        <small>765,432 ü¶¥ ‚Ä¢ 7.6543 $ZOO</small>
                    </div>
                    <div style="font-weight: bold; color: #cd7f32;">
                        –£—Ä. 15
                    </div>
                </div>
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 20px; font-size: 14px; opacity: 0.8;">
            <p>–¢–≤–æ–µ –º–µ—Å—Ç–æ: <b id="user-rank">–ó–∞–≥—Ä—É–∑–∫–∞...</b></p>
            <button class="btn-action" onclick="updateTopList()" style="margin-top: 10px;">
                üîÑ –û–±–Ω–æ–≤–∏—Ç—å
            </button>
        </div>
    </div>
    
    <!-- –í–ö–õ–ê–î–ö–ê: –ï–ñ–ï–î–ù–ï–í–ù–´–ï –ù–ê–ì–†–ê–î–´ -->
    <div id="tab-daily" class="tab-panel">
        <div class="modal-content" style="margin: auto; width: 100%;">
            <h2>üéÅ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã</h2>
            <p style="text-align: center;">–°–µ—Ä–∏—è: <span id="current-streak">0</span> –¥–Ω–µ–π</p>
            
            <div class="daily-rewards">
                <div class="daily-day" id="day1" onclick="claimDaily(1)">
                    <div>–î–µ–Ω—å 1</div>
                    <div>100 ü¶¥</div>
                </div>
                <div class="daily-day" id="day2" onclick="claimDaily(2)">
                    <div>–î–µ–Ω—å 2</div>
                    <div>200 ü¶¥</div>
                </div>
                <div class="daily-day" id="day3" onclick="claimDaily(3)">
                    <div>–î–µ–Ω—å 3</div>
                    <div>300 ü¶¥</div>
                </div>
                <div class="daily-day" id="day4" onclick="claimDaily(4)">
                    <div>–î–µ–Ω—å 4</div>
                    <div>500 ü¶¥</div>
                </div>
                <div class="daily-day" id="day5" onclick="claimDaily(5)">
                    <div>–î–µ–Ω—å 5</div>
                    <div>800 ü¶¥</div>
                </div>
                <div class="daily-day" id="day6" onclick="claimDaily(6)">
                    <div>–î–µ–Ω—å 6</div>
                    <div>1300 ü¶¥</div>
                </div>
                <div class="daily-day" id="day7" onclick="claimDaily(7)">
                    <div>–î–µ–Ω—å 7</div>
                    <div>2100 ü¶¥</div>
                </div>
            </div>
            
            <p style="text-align: center; font-size: 14px; margin-top: 20px;">
                –ó–∞—Ö–æ–¥–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—Ç—å —Å–µ—Ä–∏—é!
            </p>
            
            <button class="btn-action" onclick="showTab('tab-main')" style="width: 100%; margin-top: 20px;">
                ‚Üê –ù–∞–∑–∞–¥
            </button>
        </div>
    </div>
</div>

<nav class="nav-bar">
    <div class="nav-item active" onclick="showTab('tab-main', this)">
        <i class="fas fa-paw"></i>
        –ì–ª–∞–≤–Ω–∞—è
    </div>
    <div class="nav-item" onclick="showTab('tab-shop', this)">
        <i class="fas fa-shopping-cart"></i>
        –ú–∞–≥–∞–∑–∏–Ω
    </div>
    <div class="nav-item" onclick="showTab('tab-game', this)">
        <i class="fas fa-th"></i>
        3 –≤ —Ä—è–¥
    </div>
    <div class="nav-item" onclick="showTab('tab-top', this)">
        <i class="fas fa-trophy"></i>
        –¢–æ–ø
    </div>
    <div class="nav-item" onclick="showTab('tab-news', this)">
        <i class="fas fa-newspaper"></i>
        –ù–æ–≤–æ—Å—Ç–∏
    </div>
</nav>

<script>
    // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
    let tg = null;
    let tonConnectUI = null;
    let lastTapTime = 0;
    let gameScore = 0;
    let dailyRewardsClaimed = [];
    let achievements = [];
    
    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
    let state = {
        bones: 0,
        zoo: 0,
        energy: 1000,
        tapLvl: 1,
        energyLvl: 1,
        ownedNFTs: [],
        level: 1,
        exp: 0,
        achievements: [],
        gameHighScore: 0,
        referralCode: '',
        referrals: 0
    };
    
    // –¶–µ–Ω—ã —É–ª—É—á—à–µ–Ω–∏–π
    const upgradeCosts = {
        tap: [500, 1000, 2000, 4000, 8000, 16000, 32000, 64000, 128000, 256000],
        energy: [1000, 2000, 4000, 8000, 16000, 32000, 64000, 128000, 256000, 512000]
    };
    
    // –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã
    const dailyRewards = [100, 200, 300, 500, 800, 1300, 2100];
    
    // –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
    const achievementList = [
        { id: 'first_tap', name: '–ü–µ—Ä–≤—ã–π –∫–ª–∏–∫!', desc: '–°–¥–µ–ª–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –∫–ª–∏–∫', goal: 1, reward: 100 },
        { id: '100_clicks', name: '–ù–∞—á–∞–ª–æ –ø—É—Ç–∏', desc: '–°–¥–µ–ª–∞–π—Ç–µ 100 –∫–ª–∏–∫–æ–≤', goal: 100, reward: 500 },
        { id: '1000_clicks', name: '–£–≤–µ—Ä–µ–Ω–Ω—ã–π –∫–ª–∏–∫–µ—Ä', desc: '–°–¥–µ–ª–∞–π—Ç–µ 1000 –∫–ª–∏–∫–æ–≤', goal: 1000, reward: 2000 },
        { id: '10000_clicks', name: '–ú–∞—Å—Ç–µ—Ä –∫–ª–∏–∫–æ–≤', desc: '–°–¥–µ–ª–∞–π—Ç–µ 10000 –∫–ª–∏–∫–æ–≤', goal: 10000, reward: 10000 },
        { id: 'first_upgrade', name: '–ü–µ—Ä–≤—ã–π –∞–ø–≥—Ä–µ–π–¥', desc: '–£–ª—É—á—à–∏—Ç–µ —Å–∏–ª—É —Ç–∞–ø–∞', goal: 1, reward: 200 },
        { id: 'first_nft', name: '–ú–æ–¥–Ω–∏–∫', desc: '–ö—É–ø–∏—Ç–µ –ø–µ—Ä–≤—ã–π NFT', goal: 1, reward: 500 },
        { id: 'level_10', name: '–û–ø—ã—Ç–Ω—ã–π –∏–≥—Ä–æ–∫', desc: '–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ 10 —É—Ä–æ–≤–Ω—è', goal: 10, reward: 5000 },
        { id: 'level_20', name: '–í–µ—Ç–µ—Ä–∞–Ω', desc: '–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ 20 —É—Ä–æ–≤–Ω—è', goal: 20, reward: 15000 },
        { id: 'rich', name: '–ë–æ–≥–∞—á', desc: '–ù–∞–∫–æ–ø–∏—Ç–µ 100 $ZOO', goal: 100, reward: 10000 },
        { id: 'referral_master', name: '–°–æ—Ü–∏–∞–ª—å–Ω–∞—è –±–∞–±–æ—á–∫–∞', desc: '–ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ 5 –¥—Ä—É–∑–µ–π', goal: 5, reward: 5000 }
    ];
    
    // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
    document.addEventListener('DOMContentLoaded', function() {
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        try {
            tg = window.Telegram?.WebApp;
            if (tg) {
                tg.ready();
                tg.expand();
                tg.enableClosingConfirmation();
                
                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const user = tg.initDataUnsafe?.user;
                if (user) {
                    console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å Telegram:', user);
                    state.referralCode = 'ref_' + (user.id || Date.now()).toString().slice(-8);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ—Ñ–µ—Ä–∞–ª–∞
                    const startParam = tg.initDataUnsafe?.start_param;
                    if (startParam && startParam.startsWith('ref_')) {
                        handleReferral(startParam);
                    }
                }
            }
        } catch (e) {
            console.log('–ù–µ –≤ Telegram –∏–ª–∏ –æ—à–∏–±–∫–∞:', e);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TON Connect
        try {
            tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
                manifestUrl: 'https://raw.githubusercontent.com/ton-connect/demo-dapp-with-react-ui/master/public/tonconnect-manifest.json',
                actionsConfiguration: {
                    twaReturnUrl: 'https://t.me/ZootopiaGameBot/app'
                }
            });
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–π –∫–æ—à–µ–ª–µ–∫
            tonConnectUI.connectionRestored.then((connected) => {
                if (connected) {
                    showNotification('–ö–æ—à–µ–ª–µ–∫ TON –ø–æ–¥–∫–ª—é—á–µ–Ω!', 'success');
                }
            });
        } catch (e) {
            console.log('–û—à–∏–±–∫–∞ TON Connect:', e);
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –∏–≥—Ä—ã
        loadGame();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∏–Ω–∏-–∏–≥—Ä—ã
        initGame();
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –Ω–∞–≥—Ä–∞–¥
        loadDailyRewards();
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
        updateUI();
        
        // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑—á–∏–∫
        setTimeout(() => {
            document.getElementById('loader').classList.add('hidden');
        }, 1000);
        
        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏
        setInterval(restoreEnergy, 1000);
        
        // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        setInterval(saveGame, 30000);
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å–µ–∫—Ü–∏—é –µ—Å–ª–∏ –µ—Å—Ç—å –∫–æ–¥
        if (state.referralCode) {
            document.getElementById('referral-section').style.display = 'block';
            document.getElementById('referral-link').textContent = 
                'https://t.me/ZootopiaGameBot/app?startapp=' + state.referralCode;
        }
    });
    
    // ==================== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================
    
    function handleTap(event) {
        const now = Date.now();
        if (now - lastTapTime < 50) return; // –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞
        lastTapTime = now;
        
        if (state.energy >= 2) {
            // –ê–Ω–∏–º–∞—Ü–∏—è –∫–ª–∏–∫–∞
            createTapAnimation(event);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
            const tapPower = getTapPower();
            state.bones += tapPower;
            state.zoo += (tapPower * 0.0001);
            state.energy -= 2;
            state.exp += tapPower;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
            checkAchievements();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–≤–æ–ª—é—Ü–∏–∏
            checkEvolution();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ä–æ–≤–Ω—è
            checkLevelUp();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
            updateUI();
            
            // –í–∏–±—Ä–∞—Ü–∏—è (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)
            try {
                if (tg?.HapticFeedback) {
                    tg.HapticFeedback.impactOccurred('light');
                }
            } catch (e) {}
            
            // –ó–≤—É–∫ –∫–ª–∏–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
            playTapSound();
        } else {
            showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏!', 'warning');
        }
    }
    
    function createTapAnimation(event) {
        const anim = document.createElement('div');
        anim.className = 'tap-animation';
        anim.innerText = '+' + getTapPower();
        
        // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
        const x = event.clientX || window.innerWidth / 2;
        const y = event.clientY || window.innerHeight / 2;
        
        anim.style.left = (x - 20) + 'px';
        anim.style.top = (y - 20) + 'px';
        
        document.body.appendChild(anim);
        setTimeout(() => anim.remove(), 1000);
    }
    
    function playTapSound() {
        // –ü—Ä–æ—Å—Ç–æ–π –∑–≤—É–∫ –∫–ª–∏–∫–∞
        try {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.1);
        } catch (e) {
            console.log('–ê—É–¥–∏–æ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–æ');
        }
    }
    
    function getTapPower() {
        return state.tapLvl * (state.tapLvl < 5 ? 1 : state.tapLvl < 10 ? 2 : state.tapLvl < 15 ? 3 : 5);
    }
    
    function upgradeTap() {
        const cost = upgradeCosts.tap[state.tapLvl - 1] || state.tapLvl * 500;
        
        if (state.bones >= cost) {
            state.bones -= cost;
            state.tapLvl++;
            
            showNotification('–°–∏–ª–∞ —Ç–∞–ø–∞ —É–ª—É—á—à–µ–Ω–∞ –¥–æ —É—Ä–æ–≤–Ω—è ' + state.tapLvl + '!', 'success');
            updateUI();
            saveGame();
        } else {
            showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ—Å—Ç–µ–π! –ù—É–∂–Ω–æ: ' + cost + ' ü¶¥', 'error');
        }
    }
    
    function upgradeEnergy() {
        const cost = upgradeCosts.energy[state.energyLvl - 1] || state.energyLvl * 1000;
        
        if (state.bones >= cost) {
            state.bones -= cost;
            state.energyLvl++;
            
            showNotification('–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏ —É–ª—É—á—à–µ–Ω–æ –¥–æ —É—Ä–æ–≤–Ω—è ' + state.energyLvl + '!', 'success');
            updateUI();
            saveGame();
        } else {
            showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ—Å—Ç–µ–π! –ù—É–∂–Ω–æ: ' + cost + ' ü¶¥', 'error');
        }
    }
    
    function restoreEnergy() {
        if (state.energy < 1000) {
            const restoreRate = 1 + (state.energyLvl * 0.5);
            state.energy = Math.min(1000, state.energy + restoreRate);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —ç–Ω–µ—Ä–≥–∏–∏
            document.getElementById('en-cur').textContent = Math.floor(state.energy);
            document.getElementById('en-fill').style.width = (state.energy / 10) + '%';
        }
    }
    
    function buyNFT(id, price) {
        if (state.zoo >= price && !state.ownedNFTs.includes(id)) {
            state.zoo -= price;
            state.ownedNFTs.push(id);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º NFT –Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ
            document.getElementById('nft-' + id)?.classList.add('visible');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É
            const button = document.getElementById('buy-' + id);
            if (button) {
                button.textContent = '‚úÖ –ù–∞–¥–µ—Ç–æ';
                button.disabled = true;
            }
            
            showNotification('NFT "' + id + '" –∫—É–ø–ª–µ–Ω –∏ –Ω–∞–¥–µ—Ç!', 'success');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ
            if (!state.achievements.includes('first_nft')) {
                unlockAchievement('first_nft');
            }
            
            updateUI();
            saveGame();
        } else if (state.ownedNFTs.includes(id)) {
            showNotification('–≠—Ç–æ—Ç NFT —É–∂–µ –∫—É–ø–ª–µ–Ω!', 'warning');
        } else {
            showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ $ZOO! –ù—É–∂–Ω–æ: ' + price + ' $ZOO', 'error');
        }
    }
    
    function checkEvolution() {
        const label = document.getElementById('evo-label');
        if (state.tapLvl >= 15) {
            label.innerHTML = 'ü§ñ –ö–∏–±–µ—Ä-–¢–∞–∫—Å–∞ <small style="font-size:12px;">(–£—Ä–æ–≤–µ–Ω—å 15+)</small>';
        } else if (state.tapLvl >= 10) {
            label.innerHTML = 'ü¶∏ –¢–∞–∫—Å–∞-–°—É–ø–µ—Ä–≥–µ—Ä–æ–π <small style="font-size:12px;">(–£—Ä–æ–≤–µ–Ω—å 10+)</small>';
        } else if (state.tapLvl >= 5) {
            label.innerHTML = 'üí™ –°–∏–ª—å–Ω–∞—è –¢–∞–∫—Å–∞ <small style="font-size:12px;">(–£—Ä–æ–≤–µ–Ω—å 5+)</small>';
        } else {
            label.innerHTML = 'üê∂ –ú–∞–ª—ã—à –¢–∞–∫—Å–∞ <small style="font-size:12px;">(–£—Ä–æ–≤–µ–Ω—å 1)</small>';
        }
    }
    
    function checkLevelUp() {
        const expNeeded = state.level * 1000;
        if (state.exp >= expNeeded) {
            state.level++;
            state.exp = state.exp - expNeeded;
            
            showNotification('üéâ –ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å: ' + state.level + '!', 'success');
            
            // –ù–∞–≥—Ä–∞–¥–∞ –∑–∞ —É—Ä–æ–≤–µ–Ω—å
            state.bones += state.level * 500;
            state.zoo += state.level * 0.01;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
            if (state.level === 10 && !state.achievements.includes('level_10')) {
                unlockAchievement('level_10');
            }
            if (state.level === 20 && !state.achievements.includes('level_20')) {
                unlockAchievement('level_20');
            }
        }
    }
    
    // ==================== –°–ò–°–¢–ï–ú–ê –î–û–°–¢–ò–ñ–ï–ù–ò–ô ====================
    
    function checkAchievements() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ –∫–ª–∏–∫–∞–º
        const totalClicks = Math.floor(state.bones / getTapPower());
        
        achievementList.forEach(achievement => {
            if (state.achievements.includes(achievement.id)) return;
            
            let unlocked = false;
            
            switch(achievement.id) {
                case 'first_tap':
                    unlocked = totalClicks >= 1;
                    break;
                case '100_clicks':
                    unlocked = totalClicks >= 100;
                    break;
                case '1000_clicks':
                    unlocked = totalClicks >= 1000;
                    break;
                case '10000_clicks':
                    unlocked = totalClicks >= 10000;
                    break;
                case 'first_upgrade':
                    unlocked = state.tapLvl > 1;
                    break;
                case 'rich':
                    unlocked = state.zoo >= 100;
                    break;
                case 'referral_master':
                    unlocked = state.referrals >= 5;
                    break;
            }
            
            if (unlocked) {
                unlockAchievement(achievement.id);
            }
        });
    }
    
    function unlockAchievement(achievementId) {
        const achievement = achievementList.find(a => a.id === achievementId);
        if (!achievement) return;
        
        state.achievements.push(achievementId);
        state.bones += achievement.reward;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        document.getElementById('achievement-text').textContent = 
            achievement.name + ' - ' + achievement.desc + '\n–ù–∞–≥—Ä–∞–¥–∞: ' + achievement.reward + ' ü¶¥';
        showModal('achievement-modal');
        
        showNotification('üéâ –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ: ' + achievement.name, 'success');
        saveGame();
    }
    
    // ==================== –ú–ò–ù–ò-–ò–ì–†–ê ====================
    
    function initGame() {
        const grid = document.getElementById('grid');
        if (!grid) return;
        
        grid.innerHTML = '';
        gameScore = 0;
        
        for (let i = 0; i < 25; i++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.innerHTML = 'ü¶¥';
            cell.onclick = () => handleGameCellClick(cell, i);
            grid.appendChild(cell);
        }
        
        document.getElementById('game-score').textContent = gameScore;
    }
    
    function handleGameCellClick(cell, index) {
        if (cell.style.opacity === '0.5') return;
        
        gameScore++;
        cell.style.opacity = '0.5';
        cell.style.transform = 'scale(0.8)';
        cell.style.background = 'rgba(255, 215, 0, 0.3)';
        
        document.getElementById('game-score').textContent = gameScore;
        
        // –í–∏–±—Ä–∞—Ü–∏—è
        try {
            if (tg?.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('soft');
            }
        } catch (e) {}
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–≥—Ä–∞–¥—É
        if (gameScore >= 20) {
            document.getElementById('claim-game-btn').disabled = false;
            showNotification('üéØ –ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ! –ú–æ–∂–µ—Ç–µ –∑–∞–±—Ä–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—É.', 'success');
        }
        
        // –°–ª—É—á–∞–π–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —è—á–µ–π–∫–∏
        setTimeout(() => {
            if (Math.random() > 0.7) {
                cell.style.opacity = '1';
                cell.style.transform = 'scale(1)';
                cell.style.background = '';
                gameScore--;
                document.getElementById('game-score').textContent = gameScore;
            }
        }, 3000);
    }
    
    function claimGameRewards() {
        if (gameScore >= 20) {
            const reward = gameScore * 10;
            state.bones += reward;
            state.zoo += gameScore * 0.001;
            
            showNotification('üéÅ –ü–æ–ª—É—á–µ–Ω–æ: ' + reward + ' ü¶¥ –∏ ' + (gameScore * 0.001).toFixed(4) + ' $ZOO', 'success');
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∏–≥—Ä—É
            initGame();
            document.getElementById('claim-game-btn').disabled = true;
            
            updateUI();
            saveGame();
        }
    }
    
    function resetGame() {
        initGame();
        document.getElementById('claim-game-btn').disabled = true;
        showNotification('–ò–≥—Ä–∞ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–∞!', 'success');
    }
    
    // ==================== –ï–ñ–ï–î–ù–ï–í–ù–´–ï –ù–ê–ì–†–ê–î–´ ====================
    
    function loadDailyRewards() {
        const saved = localStorage.getItem('zootopia_daily');
        if (saved) {
            dailyRewardsClaimed = JSON.parse(saved);
        }
        
        updateDailyRewardsUI();
    }
    
    function updateDailyRewardsUI() {
        const today = new Date().toDateString();
        const lastClaim = localStorage.getItem('last_daily_claim');
        const streak = parseInt(localStorage.getItem('daily_streak') || '0');
        
        document.getElementById('current-streak').textContent = streak;
        document.getElementById('day-streak').textContent = streak;
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–µ—Ä–∏—é –µ—Å–ª–∏ –ø—Ä–æ–ø—É—Å—Ç–∏–ª–∏ –¥–µ–Ω—å
        if (lastClaim && lastClaim !== today) {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            
            if (lastClaim !== yesterday.toDateString()) {
                localStorage.setItem('daily_streak', '0');
            }
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–Ω–µ–π
        for (let i = 1; i <= 7; i++) {
            const dayElement = document.getElementById('day' + i);
            if (!dayElement) continue;
            
            dayElement.classList.remove('claimed', 'today');
            
            if (dailyRewardsClaimed.includes(i)) {
                dayElement.classList.add('claimed');
                dayElement.innerHTML = '<div>–î–µ–Ω—å ' + i + '</div><div>‚úÖ</div>';
            } else if (i === streak + 1 && lastClaim !== today) {
                dayElement.classList.add('today');
            }
        }
    }
    
    function showDailyRewards() {
        showTab('tab-daily');
        updateDailyRewardsUI();
    }
    
    function claimDaily(day) {
        const today = new Date().toDateString();
        const lastClaim = localStorage.getItem('last_daily_claim');
        const streak = parseInt(localStorage.getItem('daily_streak') || '0');
        
        if (lastClaim === today) {
            showNotification('–í—ã —É–∂–µ –ø–æ–ª—É—á–∞–ª–∏ –Ω–∞–≥—Ä–∞–¥—É —Å–µ–≥–æ–¥–Ω—è!', 'warning');
            return;
        }
        
        if (day !== streak + 1) {
            showNotification('–°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∏—Ç–µ –Ω–∞–≥—Ä–∞–¥—É –∑–∞ –¥–µ–Ω—å ' + (streak + 1), 'error');
            return;
        }
        
        const reward = dailyRewards[day - 1] || 100;
        state.bones += reward;
        state.zoo += reward * 0.001;
        
        dailyRewardsClaimed.push(day);
        localStorage.setItem('zootopia_daily', JSON.stringify(dailyRewardsClaimed));
        localStorage.setItem('last_daily_claim', today);
        localStorage.setItem('daily_streak', streak + 1);
        
        showNotification('üéÅ –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞: ' + reward + ' ü¶¥', 'success');
        
        updateDailyRewardsUI();
        updateUI();
        saveGame();
    }
    
    // ==================== –†–ï–§–ï–†–ê–õ–¨–ù–ê–Ø –°–ò–°–¢–ï–ú–ê ====================
    
    function handleReferral(refCode) {
        if (refCode === state.referralCode) {
            showNotification('–ù–µ–ª—å–∑—è –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å —Å–∞–º–æ–≥–æ —Å–µ–±—è!', 'warning');
            return;
        }
        
        const referrals = JSON.parse(localStorage.getItem('zootopia_referrals') || '{}');
        
        if (!referrals[refCode]) {
            referrals[refCode] = true;
            localStorage.setItem('zootopia_referrals', JSON.stringify(referrals));
            
            // –ù–∞–≥—Ä–∞–¥–∞ —Ä–µ—Ñ–µ—Ä–µ—Ä—É (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –±—ç–∫–µ–Ω–¥)
            showNotification('üéâ –í—ã –∑–∞—à–ª–∏ –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ!', 'success');
            
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –Ω–∞–≥—Ä–∞–¥—ã —Ä–µ—Ñ–µ—Ä–µ—Ä—É
        }
    }
    
    function copyReferralLink() {
        const link = document.getElementById('referral-link').textContent;
        
        navigator.clipboard.writeText(link).then(() => {
            showNotification('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
        }).catch(err => {
            console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ', err);
            showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É', 'error');
        });
    }
    
    // ==================== TON –ö–û–®–ï–õ–ï–ö ====================
    
    function connectWallet() {
        try {
            if (tonConnectUI) {
                tonConnectUI.openModal();
            } else {
                showNotification('TON Connect –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
            }
        } catch (e) {
            console.log('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞:', e);
            showNotification('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞', 'error');
        }
    }
    
    // ==================== UI –§–£–ù–ö–¶–ò–ò ====================
    
    function showTab(tabId, element) {
        // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
        document.querySelectorAll('.tab-panel').forEach(tab => {
            tab.classList.remove('active');
        });
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
        const tab = document.getElementById(tabId);
        if (tab) {
            tab.classList.add('active');
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
        if (element) {
            document.querySelectorAll('.nav-item').forEach(nav => {
                nav.classList.remove('active');
            });
            element.classList.add('active');
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–≥—Ä—É –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏ —Å –∏–≥—Ä–æ–π
        if (tabId === 'tab-game') {
            initGame();
        }
        
        // –ü—Ä—è—á–µ–º –º–æ–¥–∞–ª—å–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ –µ—Å–ª–∏ —É—Ö–æ–¥–∏–º —Å –Ω–∏—Ö
        if (tabId !== 'tab-daily') {
            document.getElementById('tab-daily').classList.remove('active');
        }
    }
    
    function updateUI() {
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
        document.getElementById('bones').textContent = Math.floor(state.bones).toLocaleString();
        document.getElementById('zoo-val').textContent = state.zoo.toFixed(4);
        document.getElementById('en-cur').textContent = Math.floor(state.energy);
        document.getElementById('en-fill').style.width = (state.energy / 10) + '%';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —É–ª—É—á—à–µ–Ω–∏—è
        document.getElementById('tap-lvl').textContent = state.tapLvl;
        document.getElementById('tap-power').textContent = getTapPower();
        document.getElementById('energy-lvl').textContent = state.energyLvl;
        
        const tapCost = upgradeCosts.tap[state.tapLvl - 1] || state.tapLvl * 500;
        const energyCost = upgradeCosts.energy[state.energyLvl - 1] || state.energyLvl * 1000;
        
        document.getElementById('tap-price').textContent = tapCost.toLocaleString() + ' ü¶¥';
        document.getElementById('energy-price').textContent = energyCost.toLocaleString() + ' ü¶¥';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å
        document.getElementById('level').textContent = state.level;
        const expNeeded = state.level * 1000;
        const expPercent = (state.exp / expNeeded) * 100;
        document.getElementById('level-fill').style.width = expPercent + '%';
        document.getElementById('level-progress').textContent = 
            Math.floor(state.exp).toLocaleString() + '/' + expNeeded.toLocaleString();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º NFT –∫–Ω–æ–ø–∫–∏
        ['glasses', 'hat', 'crown'].forEach(id => {
            const button = document.getElementById('buy-' + id);
            if (button) {
                if (state.ownedNFTs.includes(id)) {
                    button.textContent = '‚úÖ –ù–∞–¥–µ—Ç–æ';
                    button.disabled = true;
                    document.getElementById('nft-' + id)?.classList.add('visible');
                } else {
                    button.textContent = '–ö—É–ø–∏—Ç—å';
                    button.disabled = false;
                    document.getElementById('nft-' + id)?.classList.remove('visible');
                }
            }
        });
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ø
        updateTopList();
    }
    
    function showNotification(message, type = 'success') {
        const notification = document.getElementById('notification');
        if (!notification) return;
        
        notification.textContent = message;
        notification.className = 'notification ' + type;
        notification.classList.add('active');
        
        setTimeout(() => {
            notification.classList.remove('active');
        }, 3000);
    }
    
    function showModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.add('active');
        }
    }
    
    function hideModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.remove('active');
        }
    }
    
    // ==================== –°–û–•–†–ê–ù–ï–ù–ò–ï –ò –ó–ê–ì–†–£–ó–ö–ê ====================
    
    function saveGame() {
        try {
            localStorage.setItem('zootopia_save', JSON.stringify(state));
        } catch (e) {
            console.log('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', e);
        }
    }
    
    function loadGame() {
        try {
            const saved = localStorage.getItem('zootopia_save');
            if (saved) {
                const loaded = JSON.parse(saved);
                state = { ...state, ...loaded };
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º NFT
                state.ownedNFTs.forEach(id => {
                    document.getElementById('nft-' + id)?.classList.add('visible');
                });
            }
        } catch (e) {
            console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', e);
        }
    }
    
    // ==================== –¢–û–ü –ò–ì–†–û–ö–û–í ====================
    
    function updateTopList() {
        // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É
        // –î–ª—è –¥–µ–º–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫—É
        
        const userRank = Math.max(1, Math.floor(Math.random() * 50) + 1);
        document.getElementById('user-rank').textContent = '#' + userRank;
    }
    
    function loadTop(type) {
        // –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è —Ç–æ–ø–æ–≤
        const topList = document.getElementById('top-list');
        topList.innerHTML = `
            <div class="card">
                <div style="text-align: center; padding: 20px;">
                    <i class="fas fa-sync fa-spin" style="font-size: 24px; margin-bottom: 10px;"></i>
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–ø ${type}...</p>
                </div>
            </div>
        `;
        
        setTimeout(() => {
            updateTopList();
        }, 1000);
    }
    
    // ==================== –≠–ö–°–ü–û–†–¢ –î–õ–Ø –ì–õ–û–ë–ê–õ–¨–ù–û–ì–û –î–û–°–¢–£–ü–ê ====================
    window.handleTap = handleTap;
    window.upgradeTap = upgradeTap;
    window.upgradeEnergy = upgradeEnergy;
    window.buyNFT = buyNFT;
    window.showTab = showTab;
    window.initGame = initGame;
    window.claimGameRewards = claimGameRewards;
    window.resetGame = resetGame;
    window.showDailyRewards = showDailyRewards;
    window.claimDaily = claimDaily;
    window.connectWallet = connectWallet;
    window.copyReferralLink = copyReferralLink;
    window.updateTopList = updateTopList;
    window.loadTop = loadTop;
    window.hideModal = hideModal;
</script>
</body>
</html>
