<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Zootopia Clicker</title>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@2.0.3/dist/tonconnect-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Orbitron:wght@700&display=swap');

        :root {
            --blue: #1A5CC7;
            --gold: #FFD700;
            --accent: #FF8D29;
            --dark: #0f2345;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        body {
            font-family: 'Fredoka', sans-serif;
            background: linear-gradient(165deg, #2A75FF 0%, #1A5CC7 70%, #0f2345 100%);
            color: white;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            padding: calc(env(safe-area-inset-top) + 12px) 16px 8px;
            z-index: 100;
            background: rgba(0,0,0,0.15);
            backdrop-filter: blur(8px);
        }

        .score {
            font-family: 'Orbitron', sans-serif;
            font-size: 3.8rem;
            font-weight: 700;
            line-height: 0.9;
            letter-spacing: -1px;
        }

        .zoo-val {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            color: var(--gold);
            margin-top: 4px;
            opacity: 0.9;
        }

        /* –û–±–ª–∞—á–∫–∞ */
        .bubble {
            position: absolute;
            background: rgba(255,255,255,0.92);
            color: #1A5CC7;
            border-radius: 24px;
            padding: 10px 14px;
            font-weight: 600;
            font-size: 13px;
            text-align: center;
            box-shadow: 0 6px 0 rgba(0,0,0,0.18);
            border: 3px solid #fff;
            backdrop-filter: blur(4px);
            cursor: pointer;
            z-index: 50;
            min-width: 92px;
            transition: transform 0.12s;
        }

        .bubble:active {
            transform: scale(0.92);
        }

        .bubble::after {
            content: '';
            position: absolute;
            width: 14px;
            height: 14px;
            background: rgba(255,255,255,0.92);
            border: 3px solid #fff;
            border-top: none;
            border-left: none;
            transform: rotate(45deg);
        }

        .b-left::after  { right: -7px; top: 50%; margin-top: -7px; }
        .b-right::after { left:  -7px; top: 50%; margin-top: -7px; }

        .pos-1 { top: 18%; left: 4%; }
        .pos-2 { top: 38%; left: 4%; }
        .pos-3 { top: 58%; left: 4%; }
        .pos-4 { top: 18%; right: 4%; }
        .pos-5 { top: 38%; right: 4%; }
        .pos-6 { top: 58%; right: 4%; }

        .main-view {
            flex: 1;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0 16px;
        }

        .evo-tag {
            background: rgba(255,255,255,0.18);
            backdrop-filter: blur(6px);
            padding: 6px 18px;
            border-radius: 30px;
            font-size: 15px;
            margin-bottom: 16px;
            font-weight: 600;
        }

        .character-box {
            position: relative;
            width: 62vw;
            max-width: 260px;
            aspect-ratio: 1;
            cursor: pointer;
        }

        .main-pet {
            width: 100%;
            filter: drop-shadow(0 14px 28px rgba(0,0,0,0.45));
            transition: transform 0.15s;
        }

        .character-box:active .main-pet {
            transform: scale(1.08);
        }

        .nft-overlay {
            position: absolute;
            inset: 0;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.4s;
        }

        .nft-overlay.active {
            opacity: 1;
        }

        .energy-box {
            width: 86%;
            max-width: 360px;
            background: rgba(0,0,0,0.35);
            border-radius: 24px;
            padding: 14px 18px;
            margin-top: 24px;
            backdrop-filter: blur(6px);
        }

        .energy-bar {
            height: 14px;
            background: rgba(255,255,255,0.12);
            border-radius: 7px;
            overflow: hidden;
            margin-top: 8px;
        }

        .energy-fill {
            height: 100%;
            background: linear-gradient(90deg, #FFD700, #FFAB00);
            width: 100%;
            transition: width 0.4s ease-out;
        }

        .nav-bar {
            height: 78px;
            display: flex;
            background: rgba(0,0,0,0.4);
            border-top: 1px solid rgba(255,255,255,0.12);
            backdrop-filter: blur(10px);
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            color: #a0c0ff;
            transition: color 0.2s;
        }

        .nav-item.active {
            color: white;
        }

        .nav-item i {
            font-size: 22px;
            margin-bottom: 3px;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(10,20,50,0.94);
            backdrop-filter: blur(8px);
            z-index: 1000;
            display: none;
            flex-direction: column;
            padding: 24px 20px;
            color: white;
        }

        .modal.active {
            display: flex;
        }

        .close-modal {
            align-self: flex-end;
            font-size: 36px;
            font-weight: 300;
            margin-bottom: 12px;
            opacity: 0.7;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è +tap */
        @keyframes tapFade {
            0%   { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-80px) scale(1.4); }
        }

        .tap-text {
            position: fixed;
            pointer-events: none;
            font-family: 'Orbitron', sans-serif;
            font-weight: bold;
            font-size: 28px;
            color: var(--gold);
            text-shadow: 0 0 12px rgba(255,215,0,0.8);
            z-index: 200;
            animation: tapFade 1.1s forwards;
        }
    </style>
</head>
<body>

<header class="header">
    <div class="score" id="bones">357</div>
    <div class="zoo-val">$ZOO: <span id="zoo">0.0788</span></div>
</header>

<main class="main-view">

    <div class="bubble b-right pos-1">–¢–û–ü</div>
    <div class="bubble b-right pos-2">–ù–û–í–û–°–¢–ò</div>
    <div class="bubble b-right pos-3">3 –í –†–Ø–î</div>
    <div class="bubble b-left pos-4">NFT</div>
    <div class="bubble b-left pos-5" id="ton-connect-btn-root">–ö–û–®–ï–õ–Å–ö</div>
    <div class="bubble b-left pos-6">–ú–ê–ì–ê–ó–ò–ù</div>

    <div class="evo-tag" id="evo-label">–ú–ê–õ–´–® –¢–ê–ö–°–ê üêæ</div>

    <div class="character-box" id="tap-area">
        <img src="nft_glasses.png"   id="nft-glasses"   class="nft-overlay">
        <img src="nft_hat.png"       id="nft-hat"       class="nft-overlay">
        <img src="dachshund.png"     id="main-pet"      class="main-pet">
    </div>

    <div class="energy-box">
        <div style="display:flex; justify-content:space-between; font-size:13px; font-weight:600;">
            <span>‚ö° –≠–ù–ï–†–ì–ò–Ø</span>
            <span id="energy-text">999 / 1000</span>
        </div>
        <div class="energy-bar">
            <div class="energy-fill" id="energy-fill"></div>
        </div>
    </div>
</main>

<!-- –ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–≥–æ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ (–º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å) -->
<div id="simple-modal" class="modal">
    <span class="close-modal" onclick="closeModal('simple-modal')">√ó</span>
    <h2 style="margin:0 0 16px 0">–ó–∞–≥–æ–ª–æ–≤–æ–∫</h2>
    <p>–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞...</p>
</div>

<nav class="nav-bar">
    <div class="nav-item active"><i class="fas fa-bone"></i>–ì–ª–∞–≤–Ω–∞—è</div>
    <div class="nav-item"><i class="fas fa-rocket"></i>–ü—Ä–æ–∫–∞—á–∫–∞</div>
    <div class="nav-item"><i class="fas fa-trophy"></i>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</div>
</nav>

<script>
// ==================== –°–û–°–¢–û–Ø–ù–ò–ï –ò–ì–†–´ ====================
const tg = window.Telegram?.WebApp || {};
if (tg?.ready) {
    tg.ready();
    tg.expand();
}

const state = {
    bones: 357,
    zoo: 0.0788,
    energy: 999,
    maxEnergy: 1000,
    tapPower: 1,
    tapLevel: 1,
    energyRegenLevel: 1,
    lastUpdate: Date.now(),
    // –î–ª—è –±—É–¥—É—â–µ–π –∑–∞—â–∏—Ç—ã
    integrityHash: null
};

// ==================== TON CONNECT ====================
let tonConnectUI;

try {
    tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
        manifestUrl: 'https://your-domain.com/tonconnect-manifest.json', // ‚Üê –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –°–í–û–ô!
        buttonRootId: 'ton-connect-btn-root',
        uiPreferences: {
            theme: 'DARK'
        }
    });

    tonConnectUI.onStatusChange(wallet => {
        if (wallet) {
            console.log('Wallet connected:', wallet);
            tg?.showPopup?.({title:'–£—Å–ø–µ—Ö', message:'–ö–æ—à–µ–ª—ë–∫ –ø–æ–¥–∫–ª—é—á—ë–Ω!'});
        }
    });
} catch(e) {
    console.warn('TON Connect init failed', e);
}

// ==================== –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê ====================
function updateUI() {
    document.getElementById('bones').textContent = Math.floor(state.bones).toLocaleString();
    document.getElementById('zoo').textContent = state.zoo.toFixed(4);
    document.getElementById('energy-text').textContent = `${Math.floor(state.energy)} / ${state.maxEnergy}`;
    document.getElementById('energy-fill').style.width = (state.energy / state.maxEnergy * 100) + '%';

    // –≠–≤–æ–ª—é—Ü–∏—è (–ø—Ä–∏–º–µ—Ä)
    let evo = "–ú–ê–õ–´–® –¢–ê–ö–°–ê üêæ";
    if (state.tapLevel >= 10) evo = "–ë–û–ì–ê–¢–´–ô –¢–ê–ö–° ü§ë";
    else if (state.tapLevel >= 5) evo = "–ö–†–£–¢–û–ô –¢–ê–ö–° üí™";
    document.getElementById('evo-label').textContent = evo;
}

function createTapText(x, y, value) {
    const el = document.createElement('div');
    el.className = 'tap-text';
    el.textContent = '+' + value;
    el.style.left = x + 'px';
    el.style.top  = y + 'px';
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 1200);
}

function handleTap(e) {
    if (state.energy < 2) return;

    const now = Date.now();
    const power = state.tapPower;

    state.bones += power;
    state.zoo += 0.00015 * power;     // —á—É—Ç—å –±–æ–ª–µ–µ –æ—â—É—Ç–∏–º–∞—è —ç–∫–æ–Ω–æ–º–∏–∫–∞
    state.energy -= 2;

    // –ê–Ω–∏–º–∞—Ü–∏—è
    const x = e.touches ? e.touches[0].clientX : e.clientX;
    const y = e.touches ? e.touches[0].clientY : e.clientY;
    createTapText(x, y, power);

    tg?.HapticFeedback?.impactOccurred('medium');

    updateUI();
    // saveGame(); // –ø–æ–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ, –ø–æ—Ç–æ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
}

// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏
function restoreEnergy() {
    const now = Date.now();
    const deltaSec = (now - state.lastUpdate) / 1000;

    const regenRate = 0.8 + (state.energyRegenLevel * 0.4); // –±–∞–∑–æ–≤–æ 0.8 ‚Üí 2.0 –≤ —Å–µ–∫
    const restored = deltaSec * regenRate;

    state.energy = Math.min(state.maxEnergy, state.energy + restored);
    state.lastUpdate = now;

    updateUI();
}

setInterval(restoreEnergy, 800); // —á—É—Ç—å —á–∞—â–µ, —á–µ–º —Å–µ–∫—É–Ω–¥–∞ –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏

// ==================== –°–û–ë–´–¢–ò–Ø ====================
document.getElementById('tap-area').addEventListener('click', handleTap);
document.getElementById('tap-area').addEventListener('touchstart', e => {
    e.preventDefault();
    handleTap(e);
}, {passive: false});

updateUI();
restoreEnergy(); // –ø–µ—Ä–≤—ã–π –≤—ã–∑–æ–≤

// –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: –±—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–± –¥–∞—Ç—å —Å–µ–±–µ —Ä–µ—Å—É—Ä—Å—ã (—É–¥–∞–ª–∏—Ç—å –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–æ–º!)
window.giveMeMoney = function(amount = 10000) {
    state.bones += amount;
    state.zoo += amount * 0.001;
    updateUI();
    console.warn(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${amount} –∫–æ—Å—Ç–µ–π (–¥–ª—è —Ç–µ—Å—Ç–∞)`);
};
</script>
</body>
</html>
