<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zootopia Clicker</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: sans-serif; background: #0A0A12; color: white; text-align: center; margin: 0; overflow: hidden; touch-action: none; }
        .header { padding: 20px; border-bottom: 1px solid #333; }
        #bones { font-size: 40px; color: #FFD700; font-weight: bold; }
        .pet-image { width: 200px; margin-top: 50px; cursor: pointer; transition: 0.1s; }
        .pet-image:active { transform: scale(0.9); }
        .nav { position: fixed; bottom: 0; width: 100%; display: flex; background: #111; padding: 15px 0; }
        .nav-item { flex: 1; color: #666; font-size: 12px; }
        .active { color: #00FFFF !important; }
        #loading { position: fixed; top:0; left:0; width:100%; height:100%; background:#0A0A12; z-index:99; display:flex; align-items:center; justify-content:center; }
    </style>
</head>
<body>

<div id="loading">Загрузка данных...</div>

<div class="header">
    <div id="bones">0</div>
    <div style="color:#00FFFF">$ZOO: <span id="zoo">0.0000</span></div>
</div>

<div id="game">
    <img src="dachshund.png" class="pet-image" id="pet" alt="Doge">
    <p>⚡ Энергия: <span id="energy">1000</span>/1000</p>
</div>

<div class="nav">
    <div class="nav-item active"><i class="fas fa-paw"></i><br>Игра</div>
    <div class="nav-item" onclick="alert('Скоро!')"><i class="fas fa-shopping-cart"></i><br>Магазин</div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAT4Qt--BNvqA953AQNUbbpiDHbSvO3BfE",
        authDomain: "zootopia-f046d.firebaseapp.com",
        projectId: "zootopia-f046d",
        storageBucket: "zootopia-f046d.firebasestorage.app",
        messagingSenderId: "531125789476",
        appId: "1:531125789476:web:7e504c4d855fd397fa49b1"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const tg = window.Telegram.WebApp;
    const uid = tg.initDataUnsafe?.user?.id?.toString() || "test_user";

    let state = { bones: 0, zoo: 0, energy: 1000 };

    async function load() {
        try {
            const doc = await db.collection("users").doc(uid).get();
            if (doc.exists) state = doc.data();
            document.getElementById('loading').style.display = 'none';
            updateUI();
        } catch (e) {
            console.error(e);
            document.getElementById('loading').innerText = "Ошибка базы. Проверьте Rules!";
        }
    }

    function updateUI() {
        document.getElementById('bones').innerText = Math.floor(state.bones);
        document.getElementById('zoo').innerText = state.zoo.toFixed(4);
        document.getElementById('energy').innerText = state.energy;
    }

    document.getElementById('pet').addEventListener('click', () => {
        if (state.energy > 0) {
            state.bones++;
            state.zoo += 0.0001;
            state.energy--;
            updateUI();
            db.collection("users").doc(uid).set(state); // Сохраняем в облако
        }
    });

    setInterval(() => {
        if (state.energy < 1000) { state.energy++; updateUI(); }
    }, 2000);

    load();
</script>
</body>
</html>
