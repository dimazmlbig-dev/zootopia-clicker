<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Zootopia Ultimate</title>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@2.0.3/dist/tonconnect-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Orbitron:wght@700&display=swap');

        :root { --blue: #1A5CC7; --gold: #FFD700; --accent: #FF8D29; --dark: #0f2345; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }

        body {
            font-family: 'Fredoka', sans-serif;
            background: linear-gradient(165deg, #2A75FF 0%, #1A5CC7 70%, #0f2345 100%);
            color: white; margin: 0; height: 100vh; overflow: hidden;
            display: flex; flex-direction: column;
        }

        /* --- UI –≠–õ–ï–ú–ï–ù–¢–´ --- */
        .header { text-align: center; padding: calc(env(safe-area-inset-top) + 12px) 16px 8px; z-index: 100; background: rgba(0,0,0,0.15); backdrop-filter: blur(8px); }
        .score { font-family: 'Orbitron', sans-serif; font-size: 42px; font-weight: 700; line-height: 1; }
        .zoo-val { font-family: 'Orbitron', sans-serif; font-size: 14px; color: var(--gold); margin-top: 4px; opacity: 0.9; }

        .main-view { flex: 1; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; }

        /* –û–ë–õ–ê–ß–ö–ê */
        .bubble {
            position: absolute; background: rgba(255,255,255,0.95); color: #1A5CC7;
            border-radius: 20px; padding: 8px 12px; font-weight: 600; font-size: 12px;
            text-align: center; box-shadow: 0 4px 0 rgba(0,0,0,0.15); border: 2px solid #fff;
            cursor: pointer; z-index: 50; min-width: 85px; transition: 0.1s;
        }
        .bubble:active { transform: scale(0.95); }
        .bubble::after {
            content: ''; position: absolute; width: 10px; height: 10px;
            background: rgba(255,255,255,0.95); border: 2px solid #fff;
            border-top: none; border-left: none; transform: rotate(45deg);
        }
        .b-left::after { right: -6px; top: 50%; margin-top: -6px; }
        .b-right::after { left: -6px; top: 50%; margin-top: -6px; }

        /* –ü–æ–∑–∏—Ü–∏–∏ */
        .pos-1 { top: 15%; left: 4%; }  .pos-4 { top: 15%; right: 4%; }
        .pos-2 { top: 35%; left: 4%; }  .pos-5 { top: 35%; right: 4%; }
        .pos-3 { top: 55%; left: 4%; }  .pos-6 { top: 55%; right: 4%; }

        /* –¢–ê–ö–°–ê –ò –°–õ–û–ò */
        .character-box { position: relative; width: 65vw; max-width: 280px; aspect-ratio: 1; cursor: pointer; }
        .main-pet { width: 100%; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.4)); transition: 0.1s; }
        .character-box:active .main-pet { transform: scale(1.05); }
        
        .nft-overlay { position: absolute; inset: 0; pointer-events: none; opacity: 0; transition: opacity 0.3s; z-index: 10; width: 100%; }
        .nft-overlay.active { opacity: 1; }

        .evo-tag { background: rgba(255,255,255,0.2); backdrop-filter: blur(5px); padding: 5px 15px; border-radius: 20px; font-size: 14px; margin-bottom: 15px; font-weight: 600; }

        /* –≠–ù–ï–†–ì–ò–Ø */
        .energy-box { width: 85%; max-width: 360px; background: rgba(0,0,0,0.3); border-radius: 20px; padding: 12px 18px; margin-top: 20px; backdrop-filter: blur(6px); }
        .energy-bar { height: 12px; background: rgba(255,255,255,0.1); border-radius: 6px; overflow: hidden; margin-top: 5px; }
        .energy-fill { height: 100%; background: linear-gradient(90deg, #FFD700, #FFAB00); width: 100%; transition: width 0.4s; }

        /* –ú–û–î–ê–õ–ö–ò */
        .modal { position: fixed; inset: 0; background: rgba(10,20,50,0.95); backdrop-filter: blur(10px); z-index: 1000; display: none; flex-direction: column; padding: 30px 20px; color: white; }
        .modal.active { display: flex; animation: fadeIn 0.2s; }
        .close-btn { align-self: flex-end; font-size: 30px; margin-bottom: 10px; cursor: pointer; }
        @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }

        /* –°–ï–¢–ö–ê –ò–ì–†–´ –ò –ú–ê–ì–ê–ó–ò–ù–ê */
        .grid-container { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; margin-top: 10px; }
        .game-cell { aspect-ratio: 1; background: rgba(255,255,255,0.1); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 20px; cursor: pointer; }
        
        .shop-item { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .btn-action { background: var(--gold); border: none; padding: 8px 15px; border-radius: 10px; font-weight: bold; color: #000; cursor: pointer; }
        .btn-owned { background: #4CAF50; color: white; cursor: default; }

        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø */
        .nav-bar { height: 75px; display: flex; background: rgba(0,0,0,0.3); border-top: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(10px); }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 11px; color: #a0c0ff; }
        .nav-item.active { color: white; }
        .nav-item i { font-size: 22px; margin-bottom: 4px; }
    </style>
</head>
<body>

<header class="header">
    <div class="score" id="bones">0</div>
    <div class="zoo-val">$ZOO: <span id="zoo">0.0000</span></div>
</header>

<main class="main-view">
    <div class="bubble b-right pos-1" onclick="tg.showAlert('–¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...')">–¢–û–ü</div>
    <div class="bubble b-right pos-2" onclick="openModal('news-modal')">–ù–û–í–û–°–¢–ò</div>
    <div class="bubble b-right pos-3" onclick="openModal('game-modal')">3 –í –†–Ø–î</div>

    <div class="bubble b-left pos-4" onclick="openModal('nft-modal')">NFT</div>
    <div class="bubble b-left pos-5" id="ton-connect-btn">–ö–û–®–ï–õ–Å–ö</div>
    <div class="bubble b-left pos-6" onclick="openModal('shop-modal')">–ú–ê–ì–ê–ó–ò–ù</div>

    <div class="evo-tag" id="evo-label">–ú–ê–õ–´–® –¢–ê–ö–°–ê üêæ</div>

    <div class="character-box" id="tap-area">
        <img src="nft_glasses.png" id="layer-glasses" class="nft-overlay">
        <img src="nft_hat.png" id="layer-hat" class="nft-overlay">
        <img src="dachshund.png" class="main-pet">
    </div>

    <div class="energy-box">
        <div style="display:flex; justify-content:space-between; font-size:13px; font-weight:600;">
            <span>‚ö° –≠–ù–ï–†–ì–ò–Ø</span>
            <span id="energy-text">999 / 1000</span>
        </div>
        <div class="energy-bar"><div class="energy-fill" id="energy-fill"></div></div>
    </div>
</main>

<div id="game-modal" class="modal">
    <div class="close-btn" onclick="closeModal('game-modal')">&times;</div>
    <h2>Zootopia Match</h2>
    <p>–ö–ª–∏–∫–∞–π –ø–æ —ç–ª–µ–º–µ–Ω—Ç–∞–º!</p>
    <div id="game-grid" class="grid-container"></div>
    <p style="text-align:center; margin-top:20px;">–ù–∞–≥—Ä–∞–¥–∞: <span id="game-reward" style="color:var(--gold)">0</span> $ZOO</p>
</div>

<div id="news-modal" class="modal">
    <div class="close-btn" onclick="closeModal('news-modal')">&times;</div>
    <h2>–ù–æ–≤–æ—Å—Ç–∏ üì∞</h2>
    <div class="shop-item">
        <div><b>–ì–ª–æ–±–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</b><br><small>–î–æ–±–∞–≤–ª–µ–Ω–∞ –º–∏–Ω–∏-–∏–≥—Ä–∞ –∏ NFT!</small></div>
    </div>
    <div class="shop-item">
        <div><b>–õ–∏—Å—Ç–∏–Ω–≥ $ZOO</b><br><small>–°–∫–æ—Ä–æ –Ω–∞ –±–∏—Ä–∂–∞—Ö...</small></div>
    </div>
</div>

<div id="shop-modal" class="modal">
    <div class="close-btn" onclick="closeModal('shop-modal')">&times;</div>
    <h2>–ú–∞–≥–∞–∑–∏–Ω –ë—É—Å—Ç–æ–≤ üöÄ</h2>
    <div class="shop-item">
        <div><b>–°–∏–ª–∞ –∫–ª–∏–∫–∞</b><br><small id="tap-price">500 ü¶¥</small></div>
        <button class="btn-action" onclick="upgradeTap()">Lvl <span id="tap-lvl">1</span></button>
    </div>
</div>

<div id="nft-modal" class="modal">
    <div class="close-btn" onclick="closeModal('nft-modal')">&times;</div>
    <h2>NFT –ì–∞—Ä–¥–µ—Ä–æ–± üß¢</h2>
    <div class="shop-item">
        <div style="display:flex; align-items:center; gap:10px;">
            <img src="nft_glasses.png" width="40">
            <div><b>–û—á–∫–∏ Cyber</b><br><small>10 $ZOO</small></div>
        </div>
        <button id="btn-glasses" class="btn-action" onclick="buyNFT('glasses', 10)">–ö—É–ø–∏—Ç—å</button>
    </div>
    <div class="shop-item">
        <div style="display:flex; align-items:center; gap:10px;">
            <img src="nft_hat.png" width="40">
            <div><b>–®–ª—è–ø–∞ –®–µ—Ä–∏—Ñ–∞</b><br><small>25 $ZOO</small></div>
        </div>
        <button id="btn-hat" class="btn-action" onclick="buyNFT('hat', 25)">–ö—É–ø–∏—Ç—å</button>
    </div>
</div>

<nav class="nav-bar">
    <div class="nav-item active"><i class="fas fa-bone"></i>–ì–ª–∞–≤–Ω–∞—è</div>
    <div class="nav-item" onclick="openModal('shop-modal')"><i class="fas fa-rocket"></i>–ü—Ä–æ–∫–∞—á–∫–∞</div>
    <div class="nav-item" onclick="tg.showAlert('–°–∫–æ—Ä–æ!')"><i class="fas fa-trophy"></i>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</div>
</nav>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // –°–û–°–¢–û–Ø–ù–ò–ï
    let state = {
        bones: 357, zoo: 50.0788, energy: 999, maxEnergy: 1000,
        tapLvl: 1, ownedNFTs: []
    };

    // TON CONNECT
    const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
        manifestUrl: 'https://raw.githubusercontent.com/ton-connect/demo-dapp-with-react-ui/master/public/tonconnect-manifest.json',
        buttonRootId: 'ton-connect-btn'
    });

    // –û–ë–ù–û–í–õ–ï–ù–ò–ï UI
    function updateUI() {
        document.getElementById('bones').innerText = Math.floor(state.bones).toLocaleString();
        document.getElementById('zoo').innerText = state.zoo.toFixed(4);
        document.getElementById('energy-text').innerText = `${Math.floor(state.energy)} / ${state.maxEnergy}`;
        document.getElementById('energy-fill').style.width = (state.energy / state.maxEnergy * 100) + '%';
        
        document.getElementById('tap-lvl').innerText = state.tapLvl;
        document.getElementById('tap-price').innerText = (state.tapLvl * 500) + " ü¶¥";

        // –≠–≤–æ–ª—é—Ü–∏—è —Ç–µ–∫—Å—Ç–∞
        let label = document.getElementById('evo-label');
        if(state.tapLvl >= 10) label.innerText = "–ö–ò–ë–ï–† –¢–ê–ö–°–ê üòé";
        else if(state.tapLvl >= 5) label.innerText = "–û–ü–´–¢–ù–´–ô –ü–Å–° üêï";
    }

    // –¢–ê–ü
    document.getElementById('tap-area').addEventListener('touchstart', (e) => {
        e.preventDefault();
        if (state.energy >= 2) {
            state.energy -= 2;
            state.bones += state.tapLvl;
            state.zoo += 0.0001 * state.tapLvl;
            updateUI();
            tg.HapticFeedback.impactOccurred('medium');
            
            // –ê–Ω–∏–º–∞—Ü–∏—è —Ü–∏—Ñ—Ä—ã
            let touch = e.touches[0];
            let el = document.createElement('div');
            el.innerText = `+${state.tapLvl}`;
            el.style.position = 'fixed';
            el.style.left = touch.clientX + 'px';
            el.style.top = touch.clientY + 'px';
            el.style.color = '#FFD700';
            el.style.fontWeight = 'bold';
            el.style.zIndex = 100;
            el.style.animation = 'floatUp 1s forwards';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 1000);
        }
    });

    // –ú–ê–ì–ê–ó–ò–ù –ë–£–°–¢–û–í
    function upgradeTap() {
        let cost = state.tapLvl * 500;
        if (state.bones >= cost) {
            state.bones -= cost;
            state.tapLvl++;
            updateUI();
            tg.showAlert(`–£—Ä–æ–≤–µ–Ω—å –ø–æ–≤—ã—à–µ–Ω –¥–æ ${state.tapLvl}!`);
        } else {
            tg.showAlert("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –∫–æ—Å—Ç–µ–π!");
        }
    }

    // –ü–û–ö–£–ü–ö–ê NFT
    function buyNFT(id, price) {
        if (state.zoo >= price && !state.ownedNFTs.includes(id)) {
            state.zoo -= price;
            state.ownedNFTs.push(id);
            
            // –ù–∞–¥–µ–≤–∞–µ–º –≤–µ—â—å
            document.getElementById(`layer-${id}`).classList.add('active');
            
            // –ú–µ–Ω—è–µ–º –∫–Ω–æ–ø–∫—É
            let btn = document.getElementById(`btn-${id}`);
            btn.innerText = "–ö–£–ü–õ–ï–ù–û";
            btn.classList.add('btn-owned');
            btn.onclick = null;
            
            updateUI();
            tg.showAlert("–ü—Ä–µ–¥–º–µ—Ç —É—Å–ø–µ—à–Ω–æ –Ω–∞–¥–µ—Ç!");
        } else {
            tg.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ $ZOO –∏–ª–∏ –ø—Ä–µ–¥–º–µ—Ç —É–∂–µ –∫—É–ø–ª–µ–Ω!");
        }
    }

    // –ú–ò–ù–ò-–ò–ì–†–ê 3 –í –†–Ø–î (–£–ø—Ä–æ—â–µ–Ω–Ω–∞—è)
    function initGame() {
        const grid = document.getElementById('game-grid');
        grid.innerHTML = '';
        const icons = ['ü¶¥','ü•©','üéæ','üíé'];
        
        for(let i=0; i<25; i++) {
            let cell = document.createElement('div');
            cell.className = 'game-cell';
            cell.innerText = icons[Math.floor(Math.random() * icons.length)];
            cell.onclick = () => {
                state.zoo += 0.005;
                cell.innerText = icons[Math.floor(Math.random() * icons.length)];
                let reward = document.getElementById('game-reward');
                reward.innerText = (parseFloat(reward.innerText) + 0.005).toFixed(3);
                updateUI();
                tg.HapticFeedback.selectionChanged();
            };
            grid.appendChild(cell);
        }
    }

    // –£–ü–†–ê–í–õ–ï–ù–ò–ï –ú–û–î–ê–õ–ö–ê–ú–ò
    function openModal(id) {
        document.getElementById(id).classList.add('active');
        if(id === 'game-modal') initGame();
    }
    function closeModal(id) {
        document.getElementById(id).classList.remove('active');
    }

    // –†–ï–ì–ï–ù–ï–†–ê–¶–ò–Ø
    setInterval(() => {
        if (state.energy < state.maxEnergy) {
            state.energy = Math.min(state.maxEnergy, state.energy + 2);
            updateUI();
        }
    }, 1000);

    // –°–¢–ò–õ–ò –ê–ù–ò–ú–ê–¶–ò–ò
    const style = document.createElement('style');
    style.innerHTML = `
        @keyframes floatUp { 0% { opacity:1; transform:translateY(0); } 100% { opacity:0; transform:translateY(-50px); } }
    `;
    document.head.appendChild(style);

    updateUI();
</script>
</body>
</html>
