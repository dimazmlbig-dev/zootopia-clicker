<style>
    /* Стиль для новой вкладки Airdrop */
    .contract-address {
        background: #000;
        color: var(--gold);
        font-family: monospace;
        font-size: 10px;
        padding: 10px;
        border-radius: 8px;
        word-break: break-all;
        border: 1px dashed #444;
        margin: 10px 0;
    }
    .status-connected {
        color: #00FF88;
        font-size: 12px;
        margin-top: 10px;
        display: none; /* Покажем, когда кошелек подключится */
    }
</style>

<div id="tab-airdrop" class="tab-content">
    <h3 style="color: var(--gold); font-family: 'Orbitron';">Zootopia Airdrop</h3>
    
    <div class="card" style="display: block; text-align: center; border: 1px solid var(--accent);">
        <p style="margin: 0; font-size: 12px; color: #888;">Баланс к распределению:</p>
        <div style="font-size: 28px; color: var(--accent); font-family: 'Orbitron'; margin: 5px 0;">
            <span id="zoo-drop-val">0.0000</span> $ZOO
        </div>
        <p style="font-size: 10px; color: #666;">Монеты будут начислены на кошелек после листинга</p>
    </div>

    <div class="card" style="flex-direction: column; align-items: flex-start; background: #1a1a2e;">
        <small style="color: #888;">Официальный контракт токена:</small>
        <div class="contract-address" id="contract-text">EQB5RZDUIW3wWLWxACmKhiH6UYEGhpuCVz2BB2KI4Wyj9_8L</div>
        <button class="btn-action" style="width: 100%; font-size: 11px;" 
                onclick="window.open('https://tonviewer.com/EQB5RZDUIW3wWLWxACmKhiH6UYEGhpuCVz2BB2KI4Wyj9_8L')">
            ПРОВЕРИТЬ В TONVIEWER
        </button>
    </div>

    <div style="margin-top: 25px; text-align: center;">
        <p style="font-size: 13px; color: #fff; margin-bottom: 15px;">Привяжи кошелек для получения Airdrop</p>
        <div id="ton-connect-btn" style="display: flex; justify-content: center;"></div>
        <div id="wallet-ok" class="status-connected">✅ Кошелек привязан к профилю</div>
    </div>
</div>

<script>
    // 1. Инициализация TON Connect
    const tonConnectUI = new TONConnectUI.TonConnectUI({
        manifestUrl: 'https://dimazmlbig-dev.github.io/zootopia-clicker/tonconnect-manifest.json',
        buttonRootId: 'ton-connect-btn'
    });

    // 2. Логика отслеживания кошелька
    tonConnectUI.onStatusChange(wallet => {
        if (wallet) {
            const rawAddress = wallet.account.address;
            // Делаем адрес красивым (сокращаем)
            const friendlyAddress = rawAddress.slice(0, 4) + "..." + rawAddress.slice(-4);
            
            console.log('Кошелек подключен:', rawAddress);
            tg.HapticFeedback.notificationOccurred('success');
            
            // Показываем статус в UI
            document.getElementById('wallet-ok').style.display = 'block';
            document.getElementById('wallet-ok').innerText = "✅ Подключен: " + friendlyAddress;

            // Сохраняем адрес в нашу базу Firebase
            state.walletAddress = rawAddress;
            
            // Если мы обещали бонус за кошелек:
            if (!state.walletBonusReceived) {
                state.bones += 100000;
                state.walletBonusReceived = true;
                tg.showAlert("Поздравляем! +100,000 костей за привязку кошелька!");
            }
            save(); // Отправляем данные в облако
            update(); // Обновляем цифры на экране
        }
    });

    // Обновляем отображение $ZOO во вкладке Airdrop
    function updateAirdropUI() {
        if (document.getElementById('zoo-drop-val')) {
            document.getElementById('zoo-drop-val').innerText = state.zoo.toFixed(4);
        }
        if (state.walletAddress) {
            document.getElementById('wallet-ok').style.display = 'block';
        }
    }
    
    // Добавь вызов этой функции в свою основную функцию update()
</script>
